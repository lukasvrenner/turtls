# The TurTLS Process

This document provides a detailed overview of TurTLS's handshake procedure.
The official TLS 1.3 specification can be found [here](https://datatracker.ietf.org/doc/html/rfc8446).

## TLS Handshake
The primary role of TLS is the handshake.
The TLS handshake is a protocol in which a client and a server negotiate cryptographic parameters such as
cipher suites, keys, and more to establish a secure and private connection across an insecure channel.
Additionally, the handshake allows the client to verify the authenticity of the server, and, optionally, the server the authenticity of the client.

## Generate Private and Public Keys
Before the first message is sent, TurTLS generates keys.
Private keys are randomly generated numbers within a specific (very large) range. These are kept secret.
Public keys are generated by applying a function (more on this [later](#diffie-hellman-key-exchange)) to the private keys. These will be shared with the server.
Because a key exchange algorithm has not yet been agreed upon, a TurTLS client generates keys for each supporetd algorithm.

## Client Hello
The Client Hello is the first message sent in the TurTLS handshake. The client sends the Client Hello to the server in plaintext, meaning it is visible to all observers.
The Client Hello contains the following content:
- Legacy protocol version. This field was deprecated in TLS 1.3.
- 32 randomly generated bytes. These are used to increase entropy.
- Legacy session ID. This field was deprecated in TLS 1.3.
- A list of supported cipher suites. A cipher suite is a collection of algorithms that includes a symmetric cipher, message authenticator, and hashing algorithm. TurTLS supports the following cipher suites:
    - `TLS_AES_128_GCM_SHA256`
    - `TLS_CHACHA20_POLY1305_SHA256`
- Legacy compression methods. This field was deprecated in TLS 1.3.

The remaining fields are extensions. Some are mandatory in every handshake while others are optional.

- Supported versions. This extension provides a list of supported TLS versions. TurTLS only supports TLS 1.3.
- Cookie. Cookie is not yet supported by TurTLS but will be in the near future.
- Signature algorithms. This is a list of supported signature algorithms. TurTLS supports the following signature algorithms:
    - `ecdsa_secp256r1_sha256`: Elliptic Curve Digital Signature algorithm over the curve Secp256r1 using the SHA-256 hashing algorithm.
- Certificate Authorities. This extension is not yet supporeted by TurTLS
- Supported groups. This is a list of supported key exchange algorithms. TurTLS supports the following signature algorithms:
    - `secp256r1`: Elliptic Curve Diffie Hellman key exchange over the curve Secp256r1.
- Key share. This is a list of public keys generated at the beginning of the handshake. One key is sent for each supported key exchange algorithm.
- Server Name Indication. This extension tells the server which domain name the client is trying to access. This is useful when a server hosts more than one site. It allows the server to choose the correct certificate for the requested service.
- Application Layer Protocol Negotiation. This is a list of application layer protocols the client supports. A common example is the "h2" for HTTP/2.

There are additional extensions which are not yet supported by TurTLS.

## Hello Retry Request
TODO

## Server Hello
Upon receiving the Client Hello, the server responds with the Server Hello. The Server Hello is sent in plaintext. TurTLS does not yet support a server implementation.
The Client Hello contains the following content:
- Legacy protocol version. This field was used to negotiate which version of TLS to use. It was deprecated in TLS 1.3.
- 32 randomly generated bytes. These are used to increase entropy.
- Legacy session ID. This field was deprecated in TLS 1.3.
- Cipher suite. This is a singular cipher suite chosen from the list provided in the Client Hello.
- Legacy compression method. This field was deprecated in TLS 1.3.

The remaining fields are extensions. Some are mandatory in every handshake while others are optional.

- Supported versions. This extension contains a singular TLS version selected from the list sent in the Client Hello.
- Key share. This extension contains a singular public key that corresponds to an algorithm chosen from the list sent in the Client Hello.

## Encrypted Extensions
TODO

## TODO

## Diffie-Hellman Key Exchange
TODO

## Shared Secret Calculation
TODO

## Certificates
TODO
